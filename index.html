<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Endless Runner</title>
    <style>
        /* Basic Reset & Font */
        body {
            margin: 0;
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale;
        }

        /* Main Container */
        .main-container {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            min-height: 100vh;
            background-image: linear-gradient(to bottom, #60a5fa, #bfdbfe);
            padding: 1rem;
            box-sizing: border-box;
        }
        
        /* Feedback Button Container */
        .feedback-container {
            width: 100%;
            max-width: 350px;
            display: flex;
            justify-content: flex-end;
            margin-bottom: 0.5rem;
        }

        .feedback-button {
            padding: 0.5rem 1rem;
            background-color: #f8fafc;
            color: #475569;
            border: 1px solid #cbd5e1;
            border-radius: 0.5rem;
            cursor: pointer;
            font-weight: 600;
            transition: background-color 0.2s;
        }
        .feedback-button:hover {
            background-color: #e2e8f0;
        }

        /* Score Display */
        .score-container {
            margin-bottom: 1rem;
            text-align: center;
        }

        .score-text {
            font-size: 1.875rem;
            font-weight: 700;
            color: white;
            margin-bottom: 0.25rem;
        }

        .highscore-text {
            font-size: 1.25rem;
            font-weight: 700;
            color: #e0f2fe;
        }

        /* Game Container */
        .game-container {
            position: relative;
            width: 350px;
            height: 250px;
            background-image: linear-gradient(to bottom, #67e8f9, #fde047);
            border-radius: 0.5rem;
            overflow: hidden;
            box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.25);
            touch-action: none;
            cursor: pointer;
        }

        /* Ground */
        .ground {
            position: absolute;
            bottom: 0;
            width: 100%;
            height: 12px;
            background-color: #16a34a;
        }
        .ground-top-line {
            position: absolute;
            top: 0;
            width: 100%;
            height: 1px;
            background-color: #15803d;
        }

        /* Player */
        .player {
            position: absolute;
            left: 50px;
            width: 35px;
            height: 35px;
            background-color: #ef4444;
            border-radius: 0.5rem;
            border: 4px solid #b91c1c;
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
            z-index: 10;
        }
        .player .eye { position: absolute; top: 4px; width: 8px; height: 8px; background-color: white; border-radius: 9999px; }
        .player .eye-left { left: 6px; }
        .player .eye-right { right: 6px; }
        .player .mouth { position: absolute; bottom: 6px; left: 50%; transform: translateX(-50%); width: 12px; height: 4px; background-color: white; }

        /* Obstacle */
        .obstacle {
            position: absolute;
            bottom: 12px;
            background-color: #9333ea;
            border: 4px solid #7e22ce;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
        }

        /* Overlays (Start & Game Over) */
        .overlay {
            position: absolute; inset: 0; display: flex; align-items: center; justify-content: center; background-color: rgba(0, 0, 0, 0.6); text-align: center; color: white; padding: 1rem;
        }
        .overlay h1 { font-size: 2.25rem; font-weight: 700; margin-bottom: 0.75rem; }
        .overlay p { margin: 0; margin-bottom: 1rem; }
        .overlay .text-lg { font-size: 1.125rem; }
        .overlay .text-2xl { font-size: 1.5rem; }
        .overlay .game-over-title { color: #f87171; }
        .overlay button { padding: 0.75rem 1.5rem; border: none; color: white; font-weight: 700; font-size: 1.25rem; border-radius: 0.5rem; cursor: pointer; }
        .overlay .start-button { background-color: #22c55e; }
        .overlay .start-button:active { background-color: #16a34a; }
        .overlay .retry-button { background-color: #3b82f6; }
        .overlay .retry-button:active { background-color: #2563eb; }

        /* Instructions */
        .instructions {
            margin-top: 1rem; text-align: center; color: white; font-weight: 600; font-size: 1.125rem;
        }

        /* NEW: Feedback Modal Styles */
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.6);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 1000;
        }

        .modal-content {
            background-color: white;
            padding: 1.5rem;
            border-radius: 0.75rem;
            width: 90%;
            max-width: 400px;
            box-shadow: 0 10px 25px -5px rgba(0,0,0,0.1);
        }

        .modal-content h2 {
            margin-top: 0;
            margin-bottom: 1rem;
            color: #1e293b;
        }

        .modal-content textarea {
            width: 100%;
            height: 100px;
            padding: 0.5rem;
            border: 1px solid #cbd5e1;
            border-radius: 0.5rem;
            resize: vertical;
            box-sizing: border-box;
            margin-bottom: 1rem;
            font-family: inherit;
        }

        .modal-buttons {
            display: flex;
            justify-content: flex-end;
            gap: 0.5rem;
        }

        .modal-button {
            padding: 0.6rem 1.2rem;
            border: none;
            border-radius: 0.5rem;
            font-weight: 600;
            cursor: pointer;
            transition: background-color 0.2s;
        }

        .modal-button.cancel {
            background-color: #e2e8f0;
            color: #475569;
        }
        .modal-button.cancel:hover {
            background-color: #cbd5e1;
        }
        .modal-button.send {
            background-color: #3b82f6;
            color: white;
        }
         .modal-button.send:hover {
            background-color: #2563eb;
        }

        /* NEW: Success Toast Styles */
        .toast {
            position: fixed;
            top: -100px; /* Initially hidden above screen */
            left: 50%;
            transform: translateX(-50%);
            background-color: #22c55e;
            color: white;
            padding: 1rem 2rem;
            border-radius: 0.5rem;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
            z-index: 1001;
            font-weight: 600;
            transition: top 0.5s ease-in-out;
        }
        .toast.show {
            top: 20px; /* Animate to this position */
        }
        
    </style>
</head>
<body>

    <div class="main-container">
        <!-- Feedback Button -->
        <div class="feedback-container">
            <button id="feedback-button" class="feedback-button">Send Feedback</button>
        </div>
        
        <!-- Score Display -->
        <div class="score-container">
            <div id="score-display" class="score-text">Score: 0</div>
            <div id="highscore-display" class="highscore-text">Best: 0</div>
        </div>

        <!-- Game Container -->
        <div id="game-container" class="game-container">
            <div class="ground"><div class="ground-top-line"></div></div>
            <div id="player" class="player">
                <div class="eye eye-left"></div><div class="eye eye-right"></div><div class="mouth"></div>
            </div>
            <div id="obstacles-container"></div>
            <div id="start-overlay" class="overlay">
                <div><h1>Runner!</h1><p class="text-lg">Tap to Jump</p><button id="start-button" class="start-button">START</button></div>
            </div>
            <div id="game-over-overlay" class="overlay" style="display: none;">
                <div><h1 class="game-over-title">Game Over!</h1><p id="final-score" class="text-2xl">Score: 0</p><p id="final-best" class="text-xl">Best: 0</p><button id="retry-button" class="retry-button">RETRY</button></div>
            </div>
        </div>

        <!-- Instructions -->
        <div class="instructions">Tap anywhere to jump!</div>
    </div>

    <!-- NEW: Feedback Modal HTML Structure -->
    <div id="feedback-modal-overlay" class="modal-overlay" style="display: none;">
        <div class="modal-content">
            <h2>Send Feedback</h2>
            <textarea id="feedback-textarea" placeholder="Enter your message..."></textarea>
            <div class="modal-buttons">
                <button id="cancel-feedback-button" class="modal-button cancel">Cancel</button>
                <button id="send-feedback-button-modal" class="modal-button send">Send</button>
            </div>
        </div>
    </div>

    <!-- NEW: Success Toast HTML -->
    <div id="success-toast" class="toast">Feedback sent successfully!</div>


    <script>
        // DOM Elements
        const gameContainer = document.getElementById('game-container');
        const player = document.getElementById('player');
        const obstaclesContainer = document.getElementById('obstacles-container');
        const scoreDisplay = document.getElementById('score-display');
        const highscoreDisplay = document.getElementById('highscore-display');
        const startOverlay = document.getElementById('start-overlay');
        const gameOverOverlay = document.getElementById('game-over-overlay');
        const startButton = document.getElementById('start-button');
        const retryButton = document.getElementById('retry-button');
        const finalScore = document.getElementById('final-score');
        const finalBest = document.getElementById('final-best');
        
        // NEW: Feedback Modal Elements
        const feedbackButton = document.getElementById('feedback-button');
        const modalOverlay = document.getElementById('feedback-modal-overlay');
        const sendButtonModal = document.getElementById('send-feedback-button-modal');
        const cancelButton = document.getElementById('cancel-feedback-button');
        const feedbackTextarea = document.getElementById('feedback-textarea');
        const successToast = document.getElementById('success-toast');


        // Game State & Constants
        let gameState = 'start';
        let score = 0;
        let highScore = 0;
        let playerY = 0;
        let isJumping = false;
        let obstacles = [];
        let gameSpeed = 5;
        let velocity = 0;
        const gravity = 0.9;
        const jumpPower = -14; 
        const groundLevel = 0;
        let spawnThreshold = 250; 
        let gameLoopInterval = null;

        // --- Main Game Functions ---
        function startGame() {
            gameState = 'playing';
            score = 0;
            playerY = 0;
            obstacles = [];
            gameSpeed = 5;
            isJumping = false;
            velocity = 0;
            spawnThreshold = 250;
            startOverlay.style.display = 'none';
            gameOverOverlay.style.display = 'none';
            obstaclesContainer.innerHTML = '';
            gameLoopInterval = setInterval(gameLoop, 16);
        }

        function endGame() {
            gameState = 'gameOver';
            clearInterval(gameLoopInterval);
            if (score > highScore) { highScore = score; }
            finalScore.textContent = `Score: ${Math.floor(score / 10)}`;
            finalBest.textContent = `Best: ${Math.floor(highScore / 10)}`;
            highscoreDisplay.textContent = `Best: ${Math.floor(highScore / 10)}`;
            gameOverOverlay.style.display = 'flex';
        }

        function jump() {
            if (gameState === 'playing' && !isJumping && playerY <= 1) {
                isJumping = true;
                velocity = jumpPower;
            }
        }
        
        // --- Game Loop & Updates ---
        function gameLoop() {
            updatePlayerPhysics();
            updateObstacles();
            checkCollision();
            updateScoreAndSpeed();
            render();
        }

        function updatePlayerPhysics() {
            velocity += gravity;
            playerY += velocity;
            if (playerY >= groundLevel) {
                playerY = groundLevel;
                isJumping = false;
                velocity = 0;
            }
        }
        
        function updateObstacles() {
            let updatedObstacles = obstacles
                .map(obs => ({ ...obs, x: obs.x - gameSpeed }))
                .filter(obs => obs.x > -60);
            const lastObstacle = updatedObstacles[updatedObstacles.length - 1];
            if (!lastObstacle || lastObstacle.x < spawnThreshold) {
                 updatedObstacles.push({ x: 350, width: 25, height: 35, id: Date.now() });
                const minDistance = 300;
                const maxDistance = 800;
                const randomDistance = Math.random() * (maxDistance - minDistance) + minDistance;
                spawnThreshold = 350 - randomDistance;
            }
            obstacles = updatedObstacles;
        }

        function updateScoreAndSpeed() {
            score++;
            gameSpeed = Math.min(gameSpeed + 0.0005, 9);
        }

        function checkCollision() {
            const playerBox = { x: 50, y: 250 - (12 - playerY) - 35, width: 35, height: 35 };
            for (let obs of obstacles) {
                const obsBox = { x: obs.x, y: 250 - 12 - obs.height, width: obs.width, height: obs.height };
                if ( playerBox.x < obsBox.x + obsBox.width && playerBox.x + playerBox.width > obsBox.x && playerBox.y < obsBox.y + obsBox.height && playerBox.y + playerBox.height > obsBox.y) {
                    endGame();
                    return;
                }
            }
        }

        // --- Rendering ---
        function render() {
            player.style.bottom = `${12 - playerY}px`;
            scoreDisplay.textContent = `Score: ${Math.floor(score / 10)}`;
            obstaclesContainer.innerHTML = '';
            for (const obs of obstacles) {
                const obsElement = document.createElement('div');
                obsElement.className = 'obstacle';
                obsElement.style.left = `${obs.x}px`;
                obsElement.style.width = `${obs.width}px`;
                obsElement.style.height = `${obs.height}px`;
                obstaclesContainer.appendChild(obsElement);
            }
        }
        
        // --- Event Listeners ---
        function handleUserAction(e) {
            e.preventDefault();
            if (gameState === 'playing') { jump(); }
        }

        startButton.addEventListener('click', startGame);
        startButton.addEventListener('touchstart', (e) => { e.preventDefault(); startGame(); });
        retryButton.addEventListener('click', startGame);
        retryButton.addEventListener('touchstart', (e) => { e.preventDefault(); startGame(); });
        gameContainer.addEventListener('click', handleUserAction);
        gameContainer.addEventListener('touchstart', handleUserAction);

        // --- NEW: Feedback Modal Listeners ---
        feedbackButton.addEventListener('click', () => {
            modalOverlay.style.display = 'flex';
        });

        function closeModal() {
            modalOverlay.style.display = 'none';
        }

        cancelButton.addEventListener('click', closeModal);
        modalOverlay.addEventListener('click', (e) => {
            if (e.target === modalOverlay) { closeModal(); }
        });

        sendButtonModal.addEventListener('click', () => {
            const feedback = feedbackTextarea.value;
            if (feedback === "aaa") {
                sessionStorage.setItem('isAuthenticated', 'true');
                window.location.href = 'x.html';
            } else {
                closeModal();
                feedbackTextarea.value = ''; // Clear textarea for next time

                // Show success toast
                successToast.classList.add('show');
                setTimeout(() => {
                    successToast.classList.remove('show');
                }, 2500); // Hide after 2.5 seconds
            }
        });

    </script>
</body>
</html>
